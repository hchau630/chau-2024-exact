# Commands for reproducing Figure S7
To reproduce the plots, first download model simulation data `runs.zip` from https://www.dropbox.com/scl/fi/5npmaeo3ytgwdtofgwvlu/runs.zip?rlkey=17y7mn17yu455br4frfpmic38&st=4mith0xj&dl=0. After unzipping `runs.zip`, move the resulting `runs` directory into this directory. You can then reproduce specific plots according to the following table of commands.

| Figure | Filename | Command (run in the current directory) |
|--------|----------| -------------------------------------- |
| S7A, insets of S7B-D | -- | See `paper/README.md` |
| S7B | `figures/connection_probability_ori_0-49.pdf` | `INDICES=0-49 niarb plot plot/weights_ori.toml -o figures --linfo --progress` |
| S7C | `figures/connection_strength_space_0-49.pdf` | `INDICES=0-49 niarb plot plot/weights_space_strength.toml -o figures --linfo --progress` |
| S7C | `figures/connection_strength_ori_0-49.pdf` | `INDICES=0-49 niarb plot plot/weights_ori_strength.toml -o figures --linfo --progress` |
| S7E | `figures/resp_0-49/resp_space.pdf` | `INDICES=0-49 niarb plot plot/resp.toml -o figures/resp_0-49 --linfo --progress` |
| S7F | `figures/resp_0-49/resp_ori.pdf` | Same as S7C |
| S7G | `figures/resp_0-49/resp_space_ori.pdf` | Same as S7C |
| S7H | `figures/compare_EI_space_0-49.pdf` | `INDICES=0-49 niarb plot plot/compare_EI_space.toml -o figures --linfo --progress` |
| S7I | `figures/compare_gain_0.5_space_ct_0-49.pdf`, left subplot | `GAIN=0.5 INDICES=0-49 niarb plot plot/compare_gain_space_ct.toml -o figures --linfo --progress` |
| S7J | `figures/compare_gain_0.5_ori_ct_0-49.pdf`, left subplot | `GAIN=0.5 INDICES=0-49 niarb plot plot/compare_gain_ori_ct.toml -o figures --linfo --progress` |

The generated figures depend on the data files in `data`, the fitted model parameter files in `fits` and the fitted model perturbation response files in `runs`. The directories `data` and `fits` are soft links to the corresponding `data` and `fits` directory of `../no_disorder`. See `../no_disorder/README.md` for details about those directories.

The fitted model perturbation response files and the model connectivity files in `runs` is generated by running the following 5 commands on a SLURM cluster with A40 GPUs:
`GAIN=1 PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run.toml --linfo`
`GAIN=0.5 PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run.toml --linfo`
`PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run weights_ori.toml --linfo`
`PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run weights_space_strength.toml --linfo`
`PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run weights_ori_strength.toml --linfo`
