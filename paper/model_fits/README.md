# Commands for reproducing Figure 6
Figure 6 subplots are organized differently than those of Figures 1-5. Below is a table of which figure file each subplot corresponds to.

| Figure | Filename | Command (run in the current directory) |
|--------|----------| -------------------------------------- |
| 6A | `figures/dist_0-49/phase_diagram.pdf` | `INDICES=0-49 niarb plot plot/pairplot.toml -o figures/dist_0-49 --linfo --progress` |
| 6B | `figures/dist_0-49/kappa_disynaptic.pdf` | `INDICES=0-49 niarb plot plot/pairplot.toml -o figures/dist_0-49 --linfo --progress` |
| 6C | `figures/resp_space_0-49.pdf` | `INDICES=0-49 niarb plot plot/resp_space.toml -o figures --linfo --progress` |
| 6D | `figures/resp_ori_0-49.pdf` | `INDICES=0-49 niarb plot plot/resp_ori.toml -o figures --linfo --progress` |
| 6E | `figures/resp_space_ori_0-49.pdf` | `INDICES=0-49 niarb plot plot/resp_space_ori.toml -o figures --linfo --progress` |
| 6F | `figures/compare_EI_space_0-49.pdf` | `INDICES=0-49 niarb plot plot/compare_EI_space.toml -o figures --linfo --progress` |
| 6G | `figures/compare_gain_0.5_space_ct_0-49.pdf`, left subplot | `GAIN=0.5 INDICES=0-49 niarb plot plot/compare_gain_space_ct.toml -o figures --linfo --progress` |
| 6H | `figures/compare_gain_0.5_ori_ct_0-49.pdf`, left subplot | `GAIN=0.5 INDICES=0-49 niarb plot plot/compare_gain_ori_ct.toml -o figures --linfo --progress` |

The generated figures depend on the data files in `data`, the fitted model parameter files in `fits` and the fitted model perturbation response files in `runs`.

The data files in `data` are generated as follows:
| Filename | Command (run in the root directory of this project) |
|----------|-----------------------------------------------------|
| `ori.pkl` | `python paper/process_chettih.py paper/chettih_data/orientation.csv --ori -o paper/model_fits/data/ori.pkl` |
| `ori_bin25.pkl` | `python paper/process_chettih.py paper/chettih_data/orientation.csv --ori --binwidth 25 -o paper/model_fits/data/ori_bin25.pkl` |
| `space.pkl` | `python paper/process_chettih.py paper/chettih_data/bias.csv -o paper/model_fits/data/space.pkl` |
| `space_bin60_max550.pkl` | `python paper/process_chettih.py paper/chettih_data/bias.csv --binwidth 60 --max-space-dist 550 -o paper/model_fits/data/space_bin60_max550.pkl` |

The fitted model parameter files in `fits` is generated by running the following command on a SLURM cluster with A40 GPUs:
`PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-19 -c 8 --mem-per-cpu=4gb --time 01:00:00 --gres=gpu:a40:1 niarb fit fit.toml -o fits --linfo --ignore-errors`

The fitted model perturbation response files in `runs` is generated by running the following command on a SLURM cluster with A40 GPUs:
`PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run.toml --linfo`
