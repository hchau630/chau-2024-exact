# Commands for reproducing Figure 6, S6, and S8
To reproduce the plots, first download model simulation data `runs.zip` from https://drive.google.com/file/d/1Y5Qlz97joDoEscmQTgLyZS7CCAv7FZAt/view?usp=sharing. After unzipping `runs.zip`, move the resulting `runs` directory into this directory. You can then reproduce specific plots according to the following table of commands.

| Figure | Filename | Command (run in the current directory) |
|--------|----------| -------------------------------------- |
| 6A | `figures/dist_0-49/phase_diagram.pdf` | `INDICES=0-49 niarb plot plot/pairplot.toml -o figures/dist_0-49 --linfo --progress` |
| 6B | `figures/dist_0-49/kappa_disynaptic.pdf` | Same as 6A |
| 6C | `figures/resp_0-49/resp_space.pdf` | `INDICES=0-49 niarb plot plot/resp.toml -o figures/resp_0-49 --linfo --progress` |
| 6D | `figures/resp_0-49/resp_ori.pdf` | Same as 6C |
| 6E | `figures/resp_0-49/resp_space_ori.pdf` | Same as 6C |
| 6F | `figures/compare_EI_space_0-49.pdf` | `INDICES=0-49 niarb plot plot/compare_EI_space.toml -o figures --linfo --progress` |
| 6G | `figures/compare_gain_0.5_space_ct_0-49.pdf`, left subplot | `GAIN=0.5 INDICES=0-49 niarb plot plot/compare_gain_space_ct.toml -o figures --linfo --progress` |
| 6H | `figures/compare_gain_0.5_ori_ct_0-49.pdf`, left subplot | `GAIN=0.5 INDICES=0-49 niarb plot plot/compare_gain_ori_ct.toml -o figures --linfo --progress` |
| S6A | `figures/dist_0-49/gW_dist.pdf` | Same as 6A |
| S6B | `figures/dist_0-49/sigma_dist.pdf` | Same as 6A |
| S6C | `figures/dist_0-49/kappa_dist.pdf` | Same as 6A |
| S6D | `figures/spectral_radius_0-49.pdf` | `INDICES=0-49 niarb plot plot/weights_eigvals.toml -o figures --linfo --progress` |
| S8A-C (left) | -- | See `paper/README.md` |
| S8A (center) | `figures/compare_gain_0.5_space_ct2_space_0-49.pdf` | `GAIN=0.5 KIND=space INDICES=0-49 niarb plot plot/compare_gain_space_ct2.toml -o figures --linfo --progress` |
| S8A (right) | `figures/compare_gain_0.5_ori_ct2_space_0-49.pdf` | `GAIN=0.5 KIND=space INDICES=0-49 niarb plot plot/compare_gain_ori_ct2.toml -o figures --linfo --progress` |
| S8B (center) | `figures/compare_gain_0.5_space_ct2_ori_0-47.pdf` | `GAIN=0.5 KIND=ori INDICES=0-47 niarb plot plot/compare_gain_space_ct2.toml -o figures --linfo --progress` |
| S8B (right) | `figures/compare_gain_0.5_ori_ct2_ori_0-47.pdf` | `GAIN=0.5 KIND=ori INDICES=0-47 niarb plot plot/compare_gain_ori_ct2.toml -o figures --linfo --progress` |
| S8C (center) | `figures/compare_gain_0.5_space_ct2_space_ori_0-47.pdf` | `GAIN=0.5 KIND=space_ori INDICES=0-47 niarb plot plot/compare_gain_space_ct2.toml -o figures --linfo --progress` |
| S8C (right) | `figures/compare_gain_0.5_ori_ct2_space_ori_0-47.pdf` | `GAIN=0.5 KIND=space_ori INDICES=0-47 niarb plot plot/compare_gain_ori_ct2.toml -o figures --linfo --progress` |
| S8D | `figures/compare_gain_0.5_ori_ct2_space_ori_indiv_0-47.pdf` (loss of 0.21126 and 0.23197) | `GAIN=0.5 KIND=space_ori INDICES=0-47 niarb plot plot/compare_gain_ori_ct2_indiv.toml -o figures --linfo --progress` |

The generated figures depend on the data files in `data`, the fitted model parameter files in `fits` and the fitted model perturbation response files in `runs`.

The data files in `data` are generated as follows:
| Filename | Command (run in the root directory of this project) |
|----------|-----------------------------------------------------|
| `ori.pkl` | `python paper/process_chettih.py paper/chettih_data/orientation.csv --ori -o paper/model_fits/data/ori.pkl` |
| `ori_bin25.pkl` | `python paper/process_chettih.py paper/chettih_data/orientation.csv --ori --binwidth 25 -o paper/model_fits/data/ori_bin25.pkl` |
| `space.pkl` | `python paper/process_chettih.py paper/chettih_data/bias.csv -o paper/model_fits/data/space.pkl` |
| `space_bin60_max550.pkl` | `python paper/process_chettih.py paper/chettih_data/bias.csv --binwidth 60 --max-space-dist 550 -o paper/model_fits/data/space_bin60_max550.pkl` |

The fitted model parameter files in `fits` is generated by running the following command on a SLURM cluster with A40 GPUs:
`PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-19 -c 8 --mem-per-cpu=4gb --time 01:00:00 --gres=gpu:a40:1 niarb fit fit.toml -o fits --linfo --ignore-errors`

The fitted model perturbation response files in `runs` is generated by running the following 5 commands on a SLURM cluster with A40 GPUs:
`GAIN=1 PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run.toml --linfo`
`GAIN=0.5 PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run.toml --linfo`
`GAIN=0.5 PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run_space_gain.toml --linfo`
`GAIN=0.5 PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run_ori_gain.toml --linfo`
`GAIN=0.5 PYTORCH_CUDA_ALLOC_CONF="expandable_segments:True" sbatch --array 0-49 -c 8 --mem-per-cpu=4gb --time 00:05:00 --gres=gpu:a40:1 niarb run run_space_ori_gain.toml --linfo`
